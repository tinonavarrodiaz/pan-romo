{"version":3,"names":[],"mappings":"","sources":["scripts-admin-min.js"],"sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n\"use strict\";\n\nvar config = {\n  apiKey: \"AIzaSyAYJ-AOjByRB6-Em-XS61ZTUPB1d82ECl8\",\n  authDomain: \"panaderiaromo-f085b.firebaseapp.com\",\n  databaseURL: \"https://panaderiaromo-f085b.firebaseio.com\",\n  projectId: \"panaderiaromo-f085b\",\n  storageBucket: \"panaderiaromo-f085b.appspot.com\",\n  messagingSenderId: \"337438329949\"\n};\nfirebase.initializeApp(config);\n\nvar productsRef = firebase.database().ref().child('romo-test'),\n    db = firebase.database(),\n    productsList = document.getElementById('admin-products_list'),\n    storage = firebase.storage(),\n    bucket = storage.ref(),\n    imgRef = bucket.child('images'),\n    addProductForm = document.getElementById('addProduct');\n\nvar productTemplate = function productTemplate(_ref, id) {\n  var code = _ref.code,\n      name = _ref.name,\n      description = _ref.description,\n      urlImage = _ref.urlImage;\n\n  return \"\\n    <p class=\\\"code\\\">\" + code + \"</p>\\n    <p class=\\\"name\\\">\" + name + \"</p>\\n    <p class=\\\"description\\\">\" + description + \"</p>\\n    <img src=\\\"\" + urlImage + \"\\\" alt=\\\"\" + name + \"\\\" width=\\\"100%\\\">\\n    <button class=\\\"delete\\\" data-id=\\\"\" + id + \"\\\">Borrar</button>\\n  \";\n};\n\nvar logOut = function logOut() {\n  document.getElementById('logout').addEventListener('click', function (e) {\n    firebase.auth().signOut().then(function () {\n      location.href = 'login.html';\n    }).catch(function (err) {\n      console.log(err);\n    });\n  });\n};\n\nvar dbPush = function dbPush(data, imageURL) {\n  productsRef.push({\n    code: data.get('code'),\n    name: data.get('name'),\n    description: data.get('description'),\n    imgName: data.get('file').name,\n    urlImage: imageURL\n  }).then(function (msg) {\n    console.log(msg);\n    alert('Producto agrgado con Ã©xito');\n    document.body.removeChild(modal);\n  }).catch(function (err) {\n    return console.log(err);\n  });\n};\n\nvar uploadImage = function uploadImage(data, modal) {\n  var file = data.get('file');\n  var uploader = imgRef.child(file.name).put(file);\n  uploader.on('state_changed', function (snapshop) {}, function (err) {\n    console.log(err);\n  }, function () {\n    uploader.snapshot.ref.getDownloadURL().then(function (downloadURL) {\n      var imageURL = downloadURL;\n      dbPush(data, imageURL, modal);\n    });\n  });\n};\n\nvar deleteProduct = function deleteProduct(id) {};\n\nvar fireAction = function fireAction() {\n  productsRef.on('child_added', function (data) {\n    // console.log(data.val().urlImage)\n    var li = document.createElement('li');\n    li.id = data.key;\n    li.setAttribute('data-image', data.val().imgName);\n    li.innerHTML = productTemplate(data.val(), data.key);\n    productsList.appendChild(li);\n  });\n  productsRef.on('child_changed', function (data) {});\n  productsRef.on('child_removed', function (data) {\n    var affectedNode = document.getElementById(data.key);\n    productsList.removeChild(affectedNode);\n  });\n  addProductForm.addEventListener('submit', function (e) {\n    e.preventDefault();\n    var productFils = new FormData(e.target);\n    console.log(productFils.get('file'));\n    uploadImage(productFils);\n  });\n};\nvar createModal = function createModal() {\n  var modal = document.createElement('div');\n  modal.id = 'modal';\n  modal.className = 'modal';\n  modal.innerHTML = \"\\n    <div class=\\\"modal__container\\\">\\n      <div class=\\\"modal__close icon-close\\\" id=\\\"close\\\"></div>\\n        <form class=\\\"addProduct\\\" id=\\\"addProduct\\\">\\n          <div class=\\\"input-group modal__input-group\\\">\\n            <label for=\\\"code\\\">C\\xF3digo:</label>\\n            <input name=\\\"code\\\" id=\\\"code\\\"required>\\n          </div>\\n          <div class=\\\"input-group modal__input-group\\\">\\n            <label for=\\\"name\\\">Nombre del Producto:</label>\\n            <input name=\\\"name\\\" id=\\\"name\\\" required>\\n          </div>\\n          <div class=\\\"input-group modal__input-group\\\">\\n            <label for=\\\"description\\\">Descripci\\xF3n del Producto:</label>\\n            <textarea name=\\\"description\\\" id=\\\"description\\\" required></textarea>\\n          </div>\\n          <div class=\\\"input-group modal__input-group\\\">\\n            <label for=\\\"file\\\">Foto del Producto:</label>\\n            <input type=\\\"file\\\" name=\\\"file\\\" id=\\\"file\\\" required>\\n          </div>\\n          <footer class=\\\"modal-form-footer\\\">\\n            <button class=\\\"modal-btn-add-product\\\">Agregar</button>\\n          </footer>\\n        </form>\\n      </div>\\n    </div>\\n    \\n  \";\n  document.body.appendChild(modal);\n  modal.addEventListener('click', function (e) {\n    var t = e.target;\n    if (t.classList.contains('modal') || t.classList.contains('icon-close')) {\n      document.body.removeChild(modal);\n    }\n  });\n  modal.querySelector('form').addEventListener('submit', function (e) {\n    e.preventDefault();\n    var productFils = new FormData(e.target);\n    console.log(productFils.get('file'));\n    uploadImage(productFils, modal);\n  });\n};\n\ndocument.addEventListener(\"DOMContentLoaded\", function () {\n  if (document.body.classList.contains('Login')) {\n    var loginForm = document.getElementById('login-form');\n    loginForm.addEventListener('submit', function (e) {\n      e.preventDefault();\n      var formData = new FormData(e.target);\n      firebase.auth().signInWithEmailAndPassword(formData.get('email'), formData.get('password')).then(function (user) {\n        if (user) location.href = '../admin';\n      }).catch(function (err) {\n        console.log(err);\n      });\n    });\n  } else if (document.body.classList.contains('Admin')) {\n    firebase.auth().onAuthStateChanged(function (user) {\n      if (user) {\n        logOut();\n        fireAction();\n        document.addEventListener('click', function (e) {\n          var affectedNode = e.target.parentElement;\n          //UPDATE\n          if (e.target.matches('button.edit')) {}\n\n          //DELETE\n          if (e.target.matches('button.delete')) {\n            // console.log('Click', affectedNode)\n            var id = affectedNode.id,\n                image = affectedNode.dataset.image;\n            bucket.child(\"images/\" + image).delete().then(function () {\n              return db.ref(\"romo-test/\" + id).remove();\n            }).catch(function (err) {\n              return console.log(err);\n            });\n          }\n          if (e.target.matches('button.btn.btn-add-product')) {\n            createModal();\n          }\n        });\n      } else {\n        location.href = 'login.html';\n      }\n    });\n  }\n});\n\n},{}]},{},[1]);\n"],"file":"scripts-admin-min.js"}